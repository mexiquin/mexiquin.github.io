---
import type { AstroInstance } from "astro";
import "../styles/colorscheme.css";

interface Page extends AstroInstance {
    title?: string;
}

const topLevelPages: Page[] = Object.values(
    import.meta.glob(["../pages/*.astro", "../pages/**/index.astro"], {
        eager: true,
    }),
);

// Filter out the home page (we'll handle that separately)
const filteredPages = topLevelPages.filter((page: Page) => {
    return typeof page.url === "string" && page.url.length > 0;
});
---

<nav class="top-navigation">
    <ul class="top-navigation__list">
        <li class="top-navigation__list-item top-navigation__list-item--home">
            <a href="/" aria-label="Navigate to home page">
                <svg
                    width="85.505417mm"
                    height="85.505417mm"
                    viewBox="0 0 85.505417 85.505417"
                    version="1.1"
                    id="svg1"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <defs id="defs1"></defs>
                    <g id="layer1" transform="translate(-36.988956,-46.771579)">
                        <path
                            fill="currentColor"
                            d="m 293.01678,329.9904 h -153.216 v -153.216 h 153.216 z m -4.608,-4.608 v -144 h -144 v 144 z m -5.184,-45.504 -20.544,28.032 -19.008,-13.44 q -18.816,16.896 -43.776,20.928 -6.72,1.152 -13.44,1.152 -22.464,0 -42.048,-11.328 v -69.312 q 1.728,16.32 13.824,27.264 12.096,10.752 28.224,10.752 11.328,0 21.12,-5.568 l -12.864,-9.024 21.12,-28.416 12.288,9.024 q 1.536,-7.68 0.384,-15.168 -2.496,-15.552 -14.4,-25.536 -11.904,-10.176 -27.456,-10.176 -16.32,0 -28.416,10.944 -12.096,10.752 -13.824,26.88 v -45.888 h 110.592 q 16.512,22.464 16.512,50.496 0,18.048 -7.296,34.56 z"
                            id="logo"
                            transform="matrix(0.55807105,0,0,0.55807105,-41.029812,-51.881095)"
                        ></path>
                    </g>
                </svg>
            </a>
        </li>

        {
            filteredPages.map((page: Page) => (
                <li class="top-navigation__list-item">
                    <a href={page.url}>{page.title}</a>
                </li>
            ))
        }

        <li class="top-navigation__list-item">
            <button
                id="theme-toggle"
                class="theme-toggle"
                aria-label="Toggle theme"
            >
                <span class="sun"
                    ><svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 640 640">
                        <path
                            fill="currentColor"
                            d="M320 32C328.4 32 336.3 36.4 340.6 43.7L396.1 136.3L500.9 110C509.1 108 517.8 110.4 523.7 116.3C529.6 122.2 532 131 530 139.1L503.7 243.8L596.4 299.3C603.6 303.6 608.1 311.5 608.1 319.9C608.1 328.3 603.7 336.2 596.4 340.5L503.7 396.1L530 500.8C532 509 529.6 517.7 523.7 523.6C517.8 529.5 509 532 500.9 530L396.2 503.7L340.7 596.4C336.4 603.6 328.5 608.1 320.1 608.1C311.7 608.1 303.8 603.7 299.5 596.4L243.9 503.7L139.2 530C131 532 122.4 529.6 116.4 523.7C110.4 517.8 108 509 110 500.8L136.2 396.1L43.6 340.6C36.4 336.2 32 328.4 32 320C32 311.6 36.4 303.7 43.7 299.4L136.3 243.9L110 139.1C108 130.9 110.3 122.3 116.3 116.3C122.3 110.3 131 108 139.2 110L243.9 136.2L299.4 43.6L301.2 41C305.7 35.3 312.6 31.9 320 31.9zM320 176C240.5 176 176 240.5 176 320C176 399.5 240.5 464 320 464C399.5 464 464 399.5 464 320C464 240.5 399.5 176 320 176zM320 416C267 416 224 373 224 320C224 267 267 224 320 224C373 224 416 267 416 320C416 373 373 416 320 416z"
                        ></path></svg
                    ></span
                >
                <span class="moon"
                    ><svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 640 640"
                    >
                        <path
                            fill="currentColor"
                            d="M320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576C388.8 576 451.3 548.8 497.3 504.6C504.6 497.6 506.7 486.7 502.6 477.5C498.5 468.3 488.9 462.6 478.8 463.4C473.9 463.8 469 464 464 464C362.4 464 280 381.6 280 280C280 207.9 321.5 145.4 382.1 115.2C391.2 110.7 396.4 100.9 395.2 90.8C394 80.7 386.6 72.5 376.7 70.3C358.4 66.2 339.4 64 320 64z"
                        ></path></svg
                    ></span
                >
            </button>
        </li>
    </ul>
</nav>

<script is:inline>
    const themeToggle = document.getElementById("theme-toggle");
    themeToggle?.addEventListener("click", () => {
        const isDark = document.documentElement.classList.contains("dark");
        const newTheme = isDark ? "light" : "dark";
        document.documentElement.classList.remove("light", "dark");
        document.documentElement.classList.add(newTheme);
        localStorage.setItem("theme", newTheme);
    });
</script>

<style>
    .top-navigation {
        font-family: sans-serif;
    }

    .top-navigation__list {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0;
        gap: 1rem;
        padding: 1rem;
        align-items: center;
        background-color: var(--secondary-background-color);
    }

    .top-navigation__list-item--home {
        margin-right: auto;
    }

    .top-navigation__list-item a {
        color: var(--text-color);
    }

    .top-navigation__list-item--home {
        transition: transform 0.2s ease;
    }

    .top-navigation__list-item--home:hover {
        transform: scale(1.1);
    }

    .top-navigation__list-item--home a {
        color: var(--accent-color);
    }

    .top-navigation__list-item a:hover {
        color: var(--secondary-color);
    }

    .top-navigation__list-item--home svg {
        width: 3rem;
        height: 3rem;
    }

    .theme-toggle {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s ease;
    }

    .theme-toggle:hover {
        transform: scale(1.1);
    }

    :global(.dark) .sun {
        display: block;
        width: 2rem;
        height: 2rem;
        color: var(--secondary-color);
    }
    :global(.dark) .moon {
        display: none;
    }
    :global(.light) .sun {
        display: none;
    }
    :global(.light) .moon {
        display: block;
        width: 2rem;
        height: 2rem;
        color: var(--accent-color);
    }

    /* Default (no class yet) */
    .sun {
        display: none;
    }
    .moon {
        display: block;
    }
</style>
